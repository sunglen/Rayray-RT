/*
 * This file was automatically generated by tecsgen.
 * Move and rename like below before editing,
 *   gen/tFileSystem_templ.c => src/tFileSystem.c
 * to avoid to be overwritten by tecsgen.
 */
/* #[<PREAMBLE>]#
 * Don't edit the comments between #[<...>]# and #[</...>]#
 * These comment are used by tecsmerege when merging.
 *
 * #[</PREAMBLE>]# */

/* Put prototype declaration and/or variale definition here #_PAC_# */
#include "tFileSystem_tecsgen.h"
#include "storagedevice.h"
#include "fcntl.h"

#ifndef E_OK
#define	E_OK	0		/* success */
#define	E_ID	(-18)	/* illegal ID */
#endif

/* entry port function #_TEPF_# */
/* #[<ENTRY_PORT>]# eFileSystem
 * entry port: eFileSystem
 * signature:  sFileSystem
 * context:    task
 * #[</ENTRY_PORT>]# */

/* #[<ENTRY_FUNC>]# eFileSystem_config
 * name:         eFileSystem_config
 * global_name:  tFileSystem_eFileSystem_config
 * oneway:       false
 * #[</ENTRY_FUNC>]# */
void
eFileSystem_config()
{
	StorageDevice_t *psdev;
	char   *path, *spath;
	int    devno;

	spath = path = "0:";
	devno = SDMGetDeviceNo((const char **)&path);
	psdev = SDMGetStorageDevice(devno);

	//register
	psdev->pdevf->_sdevf_sense(psdev, true);
	//init
	psdev->pdevf->_sdevf_diskinit(psdev);
}

/* #[<ENTRY_FUNC>]# eFileSystem_openFile
 * name:         eFileSystem_openFile
 * global_name:  tFileSystem_eFileSystem_openFile
 * oneway:       false
 * #[</ENTRY_FUNC>]# */
void
eFileSystem_openFile(int32_t* fd, const char_t* p_path, int32_t flags)
{
	*fd=open(p_path, flags);
}

/* #[<ENTRY_FUNC>]# eFileSystem_readFile
 * name:         eFileSystem_readFile
 * global_name:  tFileSystem_eFileSystem_readFile
 * oneway:       false
 * #[</ENTRY_FUNC>]# */
void
eFileSystem_readFile(int32_t fd, uint8_t* p_buffer, int32_t* p_successCount, uint32_t bufferLenght)
{
	*p_successCount=read(fd, p_buffer, bufferLenght);
}

/* #[<ENTRY_FUNC>]# eFileSystem_seek
 * name:         eFileSystem_seek
 * global_name:  tFileSystem_eFileSystem_seek
 * oneway:       false
 * #[</ENTRY_FUNC>]# */
void
eFileSystem_seek(int32_t fd, int32_t* p_successCount, uint32_t offSet)
{
	*p_successCount=lseek(fd, offSet, SEEK_SET);
}

/* #[<ENTRY_FUNC>]# eFileSystem_closeFile
 * name:         eFileSystem_closeFile
 * global_name:  tFileSystem_eFileSystem_closeFile
 * oneway:       false
 * #[</ENTRY_FUNC>]# */
void
eFileSystem_closeFile(int32_t fd)
{
	close(fd);
}

/* #[<ENTRY_FUNC>]# eFileSystem_getFileInformation
 * name:         eFileSystem_getFileInformation
 * global_name:  tFileSystem_eFileSystem_getFileInformation
 * oneway:       false
 * #[</ENTRY_FUNC>]# */
void
eFileSystem_getFileInformation(struct stat* buf, const char_t* p_path)
{
	int fd;
	fd=open(p_path, O_RDONLY);
	if(fd >= 0){
		fstat(fd, buf);
		close(fd);
	}else{
		buf=NULL;
	}
}

/* #[<ENTRY_FUNC>]# eFileSystem_writeFile
 * name:         eFileSystem_writeFile
 * global_name:  tFileSystem_eFileSystem_writeFile
 * oneway:       false
 * #[</ENTRY_FUNC>]# */
void
eFileSystem_writeFile(int32_t fd, const uint8_t* p_buffer, int32_t* p_successCount, uint32_t bufferLenght)
{
	*p_successCount=write(fd, p_buffer, bufferLenght);
}

/* #[<POSTAMBLE>]#
 *   Put non-entry functions below.
 * #[</POSTAMBLE>]#*/
